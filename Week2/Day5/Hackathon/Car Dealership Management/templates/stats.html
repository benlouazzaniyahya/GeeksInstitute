
{% extends "base.html" %}

{% block content %}
<h1 class="text-3xl font-bold text-gray-800 mb-6">Dashboard</h1>

<!-- Summary Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                <i class="fas fa-car text-2xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-gray-600">Total Vehicles</p>
                <p class="text-2xl font-bold">{{ total_vehicles }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-green-100 text-green-600">
                <i class="fas fa-file-invoice-dollar text-2xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-gray-600">Total Sales</p>
                <p class="text-2xl font-bold">{{ total_sales }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                <i class="fas fa-users text-2xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-gray-600">Total Customers</p>
                <p class="text-2xl font-bold">{{ total_customers }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                <i class="fas fa-user-tie text-2xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-gray-600">Salespeople</p>
                <p class="text-2xl font-bold">{{ total_salespeople }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Sales by Month Chart -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Sales by Month</h2>
        <div class="h-80">
            <canvas id="salesByMonthChart"></canvas>
        </div>
    </div>

    <!-- Top Selling Vehicles Chart -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Top Selling Vehicles</h2>
        <div class="h-80">
            <canvas id="topVehiclesChart"></canvas>
        </div>
    </div>

    <!-- Sales by Salesperson Chart -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Sales by Salesperson</h2>
        <div class="h-80">
            <canvas id="salesByPersonChart"></canvas>
        </div>
    </div>

    <!-- Vehicle Types Distribution -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Vehicle Types Distribution</h2>
        <div class="h-80">
            <canvas id="vehicleTypesChart"></canvas>
        </div>
    </div>
</div>

<!-- Top Selling Vehicles Table -->
<div class="bg-white rounded-lg shadow-md p-6 mt-6">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Top Selling Vehicles</h2>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Make</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Model</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sales Count</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for vehicle in top_vehicles %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ vehicle[0] }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ vehicle[1] }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ vehicle[2] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Sales by Salesperson Table -->
<div class="bg-white rounded-lg shadow-md p-6 mt-6">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Sales by Salesperson</h2>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Salesperson</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sales Count</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for person in sales_by_person %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ person[0] }} {{ person[1] }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ person[2] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    // Sales by Month Chart
    const salesByMonthCtx = document.getElementById('salesByMonthChart').getContext('2d');
    const salesByMonthChart = new Chart(salesByMonthCtx, {
        type: 'bar',
        data: {
            labels: {{ sales_by_month|map(attribute='month')|list|tojson }},
            datasets: [{
                label: 'Number of Sales',
                data: {{ sales_by_month|map(attribute='count')|list|tojson }},
                backgroundColor: 'rgba(59, 130, 246, 0.5)',
                borderColor: 'rgba(59, 130, 246, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                }
            }
        }
    });

    // Top Selling Vehicles Chart
    const topVehiclesCtx = document.getElementById('topVehiclesChart').getContext('2d');
    const topVehiclesChart = new Chart(topVehiclesCtx, {
        type: 'bar',
        data: {
            labels: {{ top_vehicles|map(attribute='0')|list|tojson }}.map((make, i) => make + ' ' + {{ top_vehicles|map(attribute='1')|list|tojson }}[i]),
            datasets: [{
                label: 'Sales Count',
                data: {{ top_vehicles|map(attribute='2')|list|tojson }},
                backgroundColor: 'rgba(16, 185, 129, 0.5)',
                borderColor: 'rgba(16, 185, 129, 1)',
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                }
            }
        }
    });

    // Sales by Salesperson Chart
    const salesByPersonCtx = document.getElementById('salesByPersonChart').getContext('2d');
    const salesByPersonChart = new Chart(salesByPersonCtx, {
        type: 'bar',
        data: {
            labels: {{ sales_by_person|map(attribute='0')|list|tojson }}.map((firstName, i) => firstName + ' ' + {{ sales_by_person|map(attribute='1')|list|tojson }}[i]),
            datasets: [{
                label: 'Sales Count',
                data: {{ sales_by_person|map(attribute='2')|list|tojson }},
                backgroundColor: 'rgba(245, 158, 11, 0.5)',
                borderColor: 'rgba(245, 158, 11, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    }
                }
            }
        }
    });

    // Vehicle Types Distribution Chart
    const vehicleTypesCtx = document.getElementById('vehicleTypesChart').getContext('2d');
    const vehicleTypesChart = new Chart(vehicleTypesCtx, {
        type: 'pie',
        data: {
            labels: {{ vehicle_types|map(attribute='0')|list|tojson }},
            datasets: [{
                data: {{ vehicle_types|map(attribute='1')|list|tojson }},
                backgroundColor: [
                    'rgba(59, 130, 246, 0.5)',
                    'rgba(16, 185, 129, 0.5)',
                    'rgba(245, 158, 11, 0.5)',
                    'rgba(139, 92, 246, 0.5)',
                    'rgba(236, 72, 153, 0.5)',
                    'rgba(14, 165, 233, 0.5)'
                ],
                borderColor: [
                    'rgba(59, 130, 246, 1)',
                    'rgba(16, 185, 129, 1)',
                    'rgba(245, 158, 11, 1)',
                    'rgba(139, 92, 246, 1)',
                    'rgba(236, 72, 153, 1)',
                    'rgba(14, 165, 233, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
</script>
{% endblock %}
